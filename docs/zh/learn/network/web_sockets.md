# WebSockets

## 什么是WebSockets？
WebSocket是一种在Web浏览器和服务器之间实现双向通信的协议。它提供了一个持久化的连接，允许服务器主动向客户端推送数据，而无需客户端不断地发送请求。

传统的HTTP协议是基于请求-响应模式的，客户端发送请求，服务器返回响应，然后连接被关闭。这种模式对于需要实时更新的应用来说效率较低，因为每次都需要重新建立连接并发送请求。

WebSocket协议通过在HTTP握手阶段升级连接，从而实现了全双工的通信，即客户端和服务器可以同时发送和接收数据，而不需要经过频繁的连接和断开操作。这种持久化的连接可以保持打开状态，以实现实时的双向通信。

WebSocket的工作原理如下：
1. 建立连接：在初始HTTP请求中，客户端发送一个特殊的Upgrade头部字段，表明希望升级为WebSocket协议。服务器接受升级请求后，返回一个表示连接已升级的响应，完成WebSocket握手过程。
2. 数据传输：一旦WebSocket连接建立成功，客户端和服务器之间可以通过发送消息来进行实时通信。消息可以是文本或二进制数据。
3. 保持连接：WebSocket连接是持久化的，即连接保持打开状态，允许服务器随时主动推送数据给客户端。这消除了在每个请求中建立连接的开销。

WebSocket的应用场景包括实时聊天、多人协同编辑、实时更新和通知、在线游戏等需要实时双向通信的应用程序。

需要注意的是，WebSocket协议需要服务器端和客户端都支持。在前端开发中，可以使用浏览器提供的WebSocket API来与WebSocket服务器进行交互，而服务器端可以使用各种编程语言和框架来实现WebSocket服务器。

## WebSocket是基于什么网络层协议的？
WebSocket协议是独立的协议，它不是基于HTTP或任何其他现有协议的变种。然而，WebSocket协议的建立是通过HTTP协议的升级实现的。

在初始阶段，WebSocket连接是通过HTTP请求和响应来建立的。客户端发送一个HTTP请求，其中包含特殊的Upgrade头部字段，表明希望升级为WebSocket协议。服务器在接收到该请求后，进行协议升级，返回一个表示连接已升级的HTTP响应。升级成功后，WebSocket连接建立，并且双方可以通过WebSocket协议进行实时通信。

换句话说，WebSocket协议在初始建立连接时使用HTTP协议，但在建立连接后，实际的通信将完全使用WebSocket协议，不再依赖于HTTP。

这种协议升级的机制允许WebSocket协议在HTTP端口上使用，并通过现有的HTTP基础设施进行部署。这也使得在支持WebSocket的环境中，WebSocket可以与HTTP和HTTPS协议共存，并通过相同的端口进行通信。

因此，虽然WebSocket协议最初是通过HTTP协议的升级来建立的，但一旦连接建立成功，实际的通信将完全使用WebSocket协议，具有双向实时通信的能力。

## 